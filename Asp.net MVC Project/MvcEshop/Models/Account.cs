//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated from a template.
//
//     Manual changes to this file may cause unexpected behavior in your application.
//     Manual changes to this file will be overwritten if the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

namespace MvcEshop.Models
{
    using System.ComponentModel.DataAnnotations;
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Data.Entity;


    public partial class Account
    {
        public Account()
        {
            this.Users = new HashSet<User>();
            this.Receipts = new HashSet<Receipt>();
            this.AssignmentFiles = new HashSet<AssignmentFile>();
            this.CreditCards = new HashSet<CreditCard>();

            AccountId = System.Guid.NewGuid();
            CreateDate = System.DateTime.Now;
            IsActive = true;
            IsDeleted = false;
        }



        public System.Guid AccountId { get; set; }
        public System.Guid CreatorUserId { get; set; }

        public System.DateTime CreateDate { get; set; }
        public bool IsDeleted { get; set; }
        public bool IsActive { get; set; }
        public System.Guid ManagerUserId { get; set; }
        public System.Guid ParentAccountId { get; set; }
        public string JoinPassword { get; set; }
        public string AccountTitle { get; set; }
        public System.Guid CustomerId { get; set; }

        public virtual Account Accounts1 { get; set; }
        public virtual Account Account1 { get; set; }
        public virtual Customer Customer { get; set; }
        public virtual User Manager { get; set; }
        public virtual ICollection<User> Users { get; set; }
        public virtual ICollection<Receipt> Receipts { get; set; }
        public virtual ICollection<Class> Classes { get; set; }
        public virtual ICollection<AssignmentFile> AssignmentFiles { get; set; }
        public virtual ICollection<CreditCard> CreditCards { get; set; }

        public string DisplayCreateDate
        {
            get
            {
                return Infrastructure.Convert.GregorianToPersian(CreateDate);
            }

        }





        public Receipt CurrentContractReceipt
        {
            get
            {
                //get the last created receipt which is not expired and also it's receiptType is "offline-payment".
                if (this.Receipts.Count != 0)
                {
                    List<Receipt> lstReceipts = this.Receipts
                                .Where(current => current.IsDeleted == false &&
                                    (current.ReceiptTypeId == 2 || current.ReceiptTypeId == 4))
                                .OrderByDescending(current => current.CreateDate)
                                .ToList();

                    Receipt oCurrentContractReceipt = lstReceipts.FirstOrDefault();
                    return oCurrentContractReceipt;

                }



                return null;
            }
        }



    }
}
